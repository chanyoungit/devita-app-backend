# DEVITA: 개발자 맞춤 성장 미션 제공 서비스

## 팀원 및 역할

| <img width="122" alt="image" src="https://github.com/user-attachments/assets/c397adf8-767d-496d-b4d2-78be435704a1"> | <img width="122" alt="image" src="https://github.com/user-attachments/assets/5af0ddb4-3cd0-4c71-a2f8-f7a7ff7c693e"> | <img width="122" alt="image" src="https://github.com/user-attachments/assets/3d885f38-52ad-44f5-b9ac-1bfa30c4b0f5"> | <img width="122" alt="image" src="https://github.com/user-attachments/assets/8e5d9eeb-5049-42da-b6af-7b257db6f311"> | <img width="122" alt="image" src="https://github.com/user-attachments/assets/e78047d7-22d7-47a7-a34f-0eeb3283f05b">  | <img width="122" alt="image" src="https://github.com/user-attachments/assets/5f92b7ab-f887-4def-8266-e5c5c797c6f8"> |
|------------------------------------------------------|--------------------------------------------------|--------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------|
| [Jinho.Hong(홍진호)](https://github.com/mynameisjinhohong)                                            | [Jully.Han(한주리)](https://github.com/Hanjuri)                                           | [Ayaan.Park(박찬영)](https://github.com/chanyoungit)                                           | [Milo.Kim(김민제)](https://github.com/alswp006)                                                                                                                                               | [Winter.Park(박현혜)](https://github.com/hyeonhye126)                                                                                                                                            |[Dorothy.Kim(김도윤)](https://github.com/Do-yoon)                                               | 
| 팀장<br>DevOps                      | Front-end                                              | Back-end                                                                               | Back-end                                                                                                                                           | AI                                                                                                                                              | AI                                       |


## 💁‍♂️ Detail Role <a name = "role"></a>
+ [Jinho.Hong(홍진호)](https://github.com/mynameisjinhohong)
  - 팀장
  - 클라우드
  - 아키텍처 설계
  - 젠킨스를 활용한 CI/CD 구축
  - 개발 편의를 위한 디스코드 봇 제작
  
<Br>

+ [Ayaan.Park(박찬영)](https://github.com/chanyoungit) 
  - Back-end & DevOps
  - 인프라 아키텍쳐 설계
  - Back-end API 구현
  - Redis 관리
  - 단위 테스트 코드 작성
  - Swagger를 활용한 API 문서화

<Br>

+ [Jully.Han(한주리)](https://github.com/Hanjuri)
  - Front-end
  - React Native로의 앱 전환 및 크로스 플랫폼 환경 구축
  - Styled-components와 Framer Motion을 활용한 UI/UX 최적화 및 화면 디자인
  - Recoil과 React Query를 활용한 상태 관리 및 API 통신 성능 개선

<Br>

+ [Milo.Kim(김민제)](https://github.com/alswp006)
  - Back-end API 구현
  - Back-end 최적화 작업
  - MySQL 관리
  - Jmeter 부하 테스트

<Br>

+ [Winter.Park(박현혜)](https://github.com/hyeonhye126)
  - AI
  - GPT-4o-mini와 Few-shot Prompting으로 맞춤형 미션 생성
  - LangChain, ChromaDB 기반 RAG 데이터 검색 및 미션 생성
  - 프롬프트 설계 최적화로 AI 응답 품질 및 성능 개선

<Br>

+ [Dorothy.Kim(김도윤)](https://github.com/Do-yoon) 
  - AI
  - FastAPI를 활용한 미션 생성 API 설계 및 구현
  - LangChain과 ChromaDB를 활용한 데이터 검색 및 중복 방지 시스템 구축
  - 코사인 유사도를 활용한 중복된 미션 생성 방지 로직 설계

<Br>

<br>

# 💁🏻‍♂️ Team Introduce

<details>
   <summary> 본문 확인 (👈 Click)</summary>
<br />

## 팀 이름

일취월장

<br>

## 팀 문화

<img width="733" alt="스크린샷 2024-12-20 오후 3 53 22" src="https://github.com/user-attachments/assets/b8ee154b-a514-48b9-8058-ccb9124d80b2" /><br>
- 매주 3번 회의
  - 이전 회의 이후로 진행된 사항 공유
  - 현재 팀 전체적으로 논의할 사항 논의
  - 다음 회의까지 각자 작업할 사항 결정

<br>

![image](https://github.com/user-attachments/assets/bff91d5b-98d8-4efb-aa13-0cf906b2afbf)

- 프로젝트 관리
  - 팀 디스코드 채널을 개설하여 정보 공유 및 소통
  - Jira를 활용하여 일정 및 스프린트 관리

</details>

<br>

# 🚩 프로젝트

<details>
   <summary> 본문 확인 (👈 Click)</summary>
<br />

## Devita (develop + vitamin)
### 프로젝트 한줄 소개
개발자 맞춤 성장 미션 제공 서비스
### 프로젝트 목표
- 매일 비타민을 섭취하듯 좋은 개발 습관 형성
- 사용자 맞춤형 미션 추천
- To-do list를 통한
- 효율적이고 체계적인 일정 관리
- SNS를 통한 자신의 학습 성과 공유
- 게이미피케이션 기반 동기 부여
### 타 서비스 대비 차별점
<img width="1542" alt="image" src="https://github.com/user-attachments/assets/1108fb5b-073b-4976-9a7e-ce25fd845c45"><br>

</details>

<br>

# ☁️ 아키텍처

<details>
   <summary> 본문 확인 (👈 Click)</summary>
<br />

![image](https://github.com/user-attachments/assets/d17bd98a-f5f1-4e12-bbfc-3f0008bcdbde)

- 초창기 웹으로 개발을 진행하다 여러 논의후 앱으로 전환
- 젠킨스를 활용한 CI/CD 구축
- Nginx을 활용한 리버스프록시
- S3 버킷을 활용한 파일 관리
- VPC로 논리적으로 격리된 공간을 만들고 외부 접근 제한
  - VPC가 외부와 통신이 가능하도록 Internet Gateway 를 구성하고 라우팅 테이블에서 Public Subnet(10.0.1.0/24, 10.0.2.0/24)과 연결
  - NAT Gateway를 구성하여 나머지 Private Subnet 리소스가 인터넷으로 트래픽이 통할 수 있도록 연결

</details>

<br>

# 🎁 결과물

<details>
   <summary> 본문 확인 (👈 Click)</summary>
<br />

## 앱
### 1. 로그인

<p align="center">
  <img src="https://github.com/user-attachments/assets/9f76d769-d6e4-4824-83f2-189d6683941e" alt="Image 1" width="280">
  <img src="https://github.com/user-attachments/assets/e0b3f6ff-6add-495f-849a-fa4451247e47" alt="Image 2" width="280">
  <img src="https://github.com/user-attachments/assets/aff6e9ae-af4a-4d75-8001-f01cdc68bae8" alt="Image 3" width="280">
</p>

<br>

### 2. 관심 개발 분야 선택
<p align="center">
  <img src="https://github.com/user-attachments/assets/e21d81f9-221d-4ef8-b8be-20c66b0a5b54" alt="Image 1" width="250">
  <img src="https://github.com/user-attachments/assets/4117fc0e-9289-4a93-b271-97b9b85505cc" alt="Image 2" width="250">
  <img src="https://github.com/user-attachments/assets/aea5a88c-8019-418f-a2dc-0664aa9acd0e" alt="Image 3" width="250">
</p>

<br>

### 3. To do list
<p align="center">
  <img src="https://github.com/user-attachments/assets/f9904abd-5efe-4a3e-a9e1-0033036fff46" alt="Image 1" width="250">
  <img src="https://github.com/user-attachments/assets/a1fb6bab-a581-4479-9bfb-501a1935245d" alt="Image 2" width="250">
  <img src="https://github.com/user-attachments/assets/06eedd80-b7d7-438b-ad1b-83223f40070b" alt="Image 3" width="250">
  <img src="https://github.com/user-attachments/assets/14ce4638-b775-4417-812f-fb3bd4d640df" alt="Image 4" width="250">
  <img src="https://github.com/user-attachments/assets/e84099c0-bdbd-494a-ba40-81287d93b13d" alt="Image 5" width="250">
</p>

<br>

### 4. 카테고리
<p align="center">
  <img src="https://github.com/user-attachments/assets/9a3f7d42-3082-4cc2-bad3-5886e772ab61" alt="Image 1" width="250">
  <img src="https://github.com/user-attachments/assets/e0da4db4-6338-4b48-8ec7-7f3cbf512a3c" alt="Image 2" width="250">
  <img src="https://github.com/user-attachments/assets/bfc0ad01-6dba-48d9-bd64-0be17106d218" alt="Image 3" width="250">
</p>

<br>

### 5. AI 자율 미션 생성
<p align="center">
  <img src="https://github.com/user-attachments/assets/e0b695cf-b3aa-4eec-becd-a9bdc6258600" alt="Image 1" width="250">
  <img src="https://github.com/user-attachments/assets/7239dc4d-5cfe-4070-862c-b7089603b946" alt="Image 2" width="250">
  <img src="https://github.com/user-attachments/assets/1200ddc1-ce52-4e9a-a26e-4624b7733100" alt="Image 3" width="250">
  <img src="https://github.com/user-attachments/assets/7a7a4232-9b9b-438f-a249-0e96fac5ddb9" alt="Image 4" width="250">
  <img src="https://github.com/user-attachments/assets/90b6c442-3ce5-48fc-b266-23f19c43ef2a" alt="Image 5" width="250">
  <img src="https://github.com/user-attachments/assets/86b241d7-0f43-4a05-a266-26ec057a4c3b" alt="Image 6" width="250">
  <img src="https://github.com/user-attachments/assets/58ff9754-7402-4c5b-9398-b24e4b929530" alt="Image 7" width="250">
  <img src="https://github.com/user-attachments/assets/a1de2022-6f6d-4433-9f29-55b787b7542c" alt="Image 8" width="250">
  <img src="https://github.com/user-attachments/assets/0f94be72-52ac-4e51-bb30-baff673a09d5" alt="Image 9" width="250">
</p>

<br>

### 6. SNS
<p align="center">
  <img src="https://github.com/user-attachments/assets/05b370dd-832d-4636-85f8-f0f3efc4c8c9" alt="Image 1" width="250">
  <img src="https://github.com/user-attachments/assets/65c08141-8cce-4e52-a897-e6595d4be8f7" alt="Image 2" width="250">
  <img src="https://github.com/user-attachments/assets/2e3f5778-db85-4ce3-9bcc-558afa80b362" alt="Image 3" width="250">
  <img src="https://github.com/user-attachments/assets/9b6af7cb-d9c0-4cbf-9f45-70acd6a3ad38" alt="Image 4" width="250">
  <img src="https://github.com/user-attachments/assets/dcf4a32e-5227-454f-ab29-4af99abb8fe5" alt="Image 5" width="250">
  <img src="https://github.com/user-attachments/assets/72167e63-0a5b-4380-b42f-207f9df22331" alt="Image 6" width="250">
  <img src="https://github.com/user-attachments/assets/3abce6d5-81c1-48b0-8267-72f17e362766" alt="Image 7" width="250">
  <img src="https://github.com/user-attachments/assets/269cddc6-5bd8-40da-870c-e74bdcf5f52e" alt="Image 8" width="250">
  <img src="https://github.com/user-attachments/assets/597d0cd0-71e7-4bf9-b6ed-d3249700fd0f" alt="Image 9" width="250">
  <img src="https://github.com/user-attachments/assets/b97e3ceb-2b4b-4d0e-8e0f-55ee2c95ed1b" alt="Image 10" width="250">
  <img src="https://github.com/user-attachments/assets/d377fe97-5206-4cb7-be08-c7989676cbfc" alt="Image 11" width="250">
  <img src="https://github.com/user-attachments/assets/674c2326-67c3-485a-a0f6-f636e9615f7f" alt="Image 12" width="250">
  <img src="https://github.com/user-attachments/assets/9b4fcc1d-7d4e-4d1d-8372-98f1064b99db" alt="Image 13" width="250">
</p>

<br>

### 7. 캐릭터
<p align="center">
  <img src="https://github.com/user-attachments/assets/ff0d2fdc-143d-4aba-b9f6-9283bb87ab9d" alt="Image 1" width="250">
  <img src="https://github.com/user-attachments/assets/3fde5421-240d-426a-9b1f-1915d6e604a6" alt="Image 2" width="250">
  <img src="https://github.com/user-attachments/assets/f6cbae9a-6ad8-42c1-a144-492680397dc9" alt="Image 3" width="250">
</p>

<br>

### 8. 로그아웃
<p align="center">
  <img src="https://github.com/user-attachments/assets/a7ba87cb-f490-4206-b6f2-1234f6ccbc6f" alt="Image 1" width="250">
</p>

</details>

<br>

# 🔨 Back-end

<br>

### Virtual Thread

MVP를 빠르게 구현해야 하는 상황에서, 웹플럭스는 학습 곡선이 높아 대신 JDK 17에서 JDK 21로 마이그레이션하며 새로운 버추얼 스레드 기능을 도입했습니다. 이를 통해 AI 서버와의 비동기 요청을 최적화하여 성능을 크게 개선할 수 있었습니다. 테스트 결과, Virtual Thread를 활용한 방식이 기존의 RestTemplate 방식보다 초당 throughput이 4배 이상 향상되었으며, AI 서버가 과부하되지 않는 범위 내에서 성능을 최적화할 수 있었습니다.

<br>

### OAuth2, JWT 기반 로그인 시스템 구현

해당 프로젝트는 보안성과 사용자 편의성을 강화하기 위해 OAuth2를 기반으로 소셜 로그인 시스템을 설계했습니다. 이 과정에서 무상태성을 유지하며 인증을 처리하기 위해 JWT(JSON Web Token)를 사용하였고, Redis와 쿠키에 Refresh 토큰을 저장하는 방식을 도입하였습니다.

Redis는 빠른 데이터 처리 속도와 중앙 집중식 관리가 가능하며, TTL 기능을 활용해 토큰 만료 및 삭제를 자동화할 수 있어 보안과 성능을 동시세 강화하는 데 유리합니다. 이를 기반으로 Refresh 토큰 로테이션 방식을 적용하여 보안성을 더욱 강화했습니다. 이를 통해 보안 위협을 최소화하고, 사용자 인증 정보를 안전하게 관리할 수 있었습니다.

<br>

### Redis를 활용한 동시성 이슈 로직 처리

SNS 기능 중 하나인 좋아요 기능의 동시성 처리를 위해 낙관적 락, 비관적 락, 그리고 Redis의 성능을 JMeter를 사용해 비교해보았습니다.

낙관적 락은 충돌 가능성을 허용한 뒤 커밋 시점에서 충돌을 검증하는 방식으로 동작하기 때문에 소요 시간을 고려하여 100번 이상 반복되는 테스트는 실패하다록 설정했습니다. 테스트 결과, 성능 저하와 높은 에러율이 확인되었습니다. 50000개의 요청 중 8595개만 성공적으로 처리되었으며, 나머지 요청은 충돌로 인해 실패했습니다. 테스트는 총 1분 13초가 소요되었고, 82.81%의 에러율과 초당 Throughput 678.5라는 결과가 나왔습니다. 낙관적 락 방식에서는 잦은 충돌로 인해 성능이 크게 저하되는 것을 확인할 수 있었습니다.

비관적 락은 데이터 충돌 가능성을 미리 차단하며, 순차적으로 데이터를 처리하기 때문에 50000개의 요청이 모두 성공적으로 처리되었으며, 테스트 시간은 31초로 낙관적 락보다 약 2배 이상 빠른 성능을 보여주었습니다. 에러율은 0%로 낮은 에러율이 나왔고, 초당 Throughput 1582.6이라는 결과를 확인할 수 있었습니다. 그러나 비관적 락은 동시성 처리를 차단하기 때문에 많은 요청이 몰릴 경우 대기 시간이 증가할 가능성이 있었습니다.

Redis는 단일 스레드로 동작하지만, In-Memory DB로써 데이터베이스 통신 비용이 적고 빠른 데이터 처리가 가능하기 때문에 50000개의 요청이 모두 성공적으로 처리되었으며, 테스트 시간은 14초로 비관적 락보다 약 2배 빠른 성능을 보였습니다. Throughput은 초당 3417.2라는 결과를 확인할 수 있었습니다. 또한, Redis 6부터는 네트워크 I/O 처리를 위한 추가 스레드(최대 3개)가 도입되어 더 높은 처리량을 제공할 수 있었습니다.

이러한 이점을 바탕으로 Redis를 좋아요 기능의 동시성 처리에 적용하기로 결정했습니다. 또한, 데이터를 영구적으로 저장하기 위해 RDB 방식을 활용했습니다. RDB는 AOF 방식에 비해 데이터 손실 위험이 있지만, 좋아요 수와 같은 특정 데이터는 약간의 손실보다 파일 크기가 더 중요한 요소라고 판단하여 상대적으로 작은 파일 크기를 가진 RDB 방식을 선택했습니다.

<br>

### 팔로우 조회 시 DB 서버 부하를 고려한 캐시 전략

팔로우와 같은 데이터는 자주 조회되지만 변경은 상대적으로 적습니다. 사용자가 증가함에 따라 이러한 팔로우 데이터는 매번 DB에서 조회해야 하기 때문에 DB에 큰 부하를 예상했습니다. 이를 대비해 Redis를 캐시로 사용하여 DB에 대한 조회 부하를 줄이고, 캐시된 데이터를 빠르게 제공하여 DB에 부하를 줄이도록 구현했습니다. 

<br>

### 미션 보상 시 데이터 무결성을 위한 트랜잭션 적용

일일 미션이나 To-do를 완료하면 보상이 지급되며, 보상은 처음으로 완료했을 때만 지급됩니다. 또한, 일일 보상에는 제한이 있어 이를 관리하기 위해 Redis의 TTL 기능을 활용하고 있습니다. To-do나 미션의 상태가 변경될 때마다 MySQL과 Redis를 여러 번 조회하고 수정하게 되므로, 예외가 발생할 경우 적용된 사항들이 저장되지 않도록 롤백할 수 있는 트랜잭션을 적용하였습니다. 이를 통해 데이터 일관성을 유지하고, 시스템 안정성을 확보할 수 있었습니다.

<br>

### 스케줄러를 활용한 AI 서버와 통신

오전 9시마다 사용자 맞춤형 미션을 생성하는 기능이 있습니다. 정해진 시간마다 AI 서버에 요청을 보내는 기능은 스케줄러를 활용하여 모든 사용자에 대한 일일 미션을 자동으로 생성하고 DB에 저장하도록 구현했습니다.

<br>

### Junit5와 Mockito로 고립된 단위테스트 작성

소스코드를 작성하거나 변경 시 오류가 나지 않는지 기능을 하나하나 URL에 데이터를 보내 직접 테스트를 했어야 했습니다. 이런 불편을 개선하기 위해 서비스 로직을 대상으로 Junit5와 Mockito를 활용한 단위 테스트를 작성하였습니다. 의존성이 있는 객체를 대상으로 Mock DAO 객체를 만들어 주입하였고, DB에서 예상되는 결과값들을 반환하도록 설정하였습니다. 그 결과 Service 레이어에 있는 로직을 중심으로 고립된 단위 테스트를 제작할 수 있었습니다. 또한, Mockito Framework를 사용하여 Spring container가 올라가지 않고, DB와의 커넥션을 하지 않기 때문에 빠른 테스트가 가능하도록 하였습니다.

<br>

### JPA 성능 최적화
JPA를 사용하면서 발생할 수 있는 문제점 중 하나로, 사용하기 편리한 만큼 성능적인 부분을 쉽게 간과할 수 있다고 생각했습니다. 이번 프로젝트에서는 Fetch 전략을 LAZY로 설정하여 해당 로직에 반드시 필요한 쿼리만 실행되도록 구현하였으며 N+1 문제가 발생하는 부분을 찾아 리팩토링하는 과정을 진행하여 불필요한 쿼리가 실행되는 것을 최소화할 수 있도록 구현했습니다.

<br>

### Swagger를 활용한 API 문서화
API 문서를 수동으로 관리하게 된다면 애플리케이션을 수정해야 하는 상황이 발생했을 때 API 문서도 수동으로 변경하는 작업을 거쳐야 합니다. 또한, 이러한 작업은 자동화 작업이 아니기 떄문에 실수할 가능성이 존재합니다. 이러한 문제를 사전에 방지하기 위해 Swagger를 활용한 API 문서의 자동화를 적용하게 되었습니다.
